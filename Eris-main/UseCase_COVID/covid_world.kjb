<?xml version="1.0" encoding="UTF-8"?>
<job>
  <name>COVID World</name>
  <description/>
  <extended_description/>
  <job_version/>
  <job_status>0</job_status>
  <directory>/</directory>
  <created_user>-</created_user>
  <created_date>2020/11/17 05:20:29.489</created_date>
  <modified_user>-</modified_user>
  <modified_date>2020/11/17 05:20:29.489</modified_date>
  <parameters>
    </parameters>
  <connection>
    <name>COVID-DB</name>
    <server>${host}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${db}</database>
    <port>5432</port>
    <username>${user}</username>
    <password>${password}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <slaveservers>
    </slaveservers>
  <job-log-table>
    <connection/>
    <schema/>
    <table/>
    <size_limit_lines/>
    <interval/>
    <timeout_days/>
    <field>
      <id>ID_JOB</id>
      <enabled>Y</enabled>
      <name>ID_JOB</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>JOBNAME</name>
    </field>
    <field>
      <id>STATUS</id>
      <enabled>Y</enabled>
      <name>STATUS</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>STARTDATE</id>
      <enabled>Y</enabled>
      <name>STARTDATE</name>
    </field>
    <field>
      <id>ENDDATE</id>
      <enabled>Y</enabled>
      <name>ENDDATE</name>
    </field>
    <field>
      <id>LOGDATE</id>
      <enabled>Y</enabled>
      <name>LOGDATE</name>
    </field>
    <field>
      <id>DEPDATE</id>
      <enabled>Y</enabled>
      <name>DEPDATE</name>
    </field>
    <field>
      <id>REPLAYDATE</id>
      <enabled>Y</enabled>
      <name>REPLAYDATE</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>Y</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>EXECUTING_SERVER</id>
      <enabled>N</enabled>
      <name>EXECUTING_SERVER</name>
    </field>
    <field>
      <id>EXECUTING_USER</id>
      <enabled>N</enabled>
      <name>EXECUTING_USER</name>
    </field>
    <field>
      <id>START_JOB_ENTRY</id>
      <enabled>N</enabled>
      <name>START_JOB_ENTRY</name>
    </field>
    <field>
      <id>CLIENT</id>
      <enabled>N</enabled>
      <name>CLIENT</name>
    </field>
  </job-log-table>
  <jobentry-log-table>
    <connection/>
    <schema/>
    <table/>
    <timeout_days/>
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>TRANSNAME</name>
    </field>
    <field>
      <id>JOBENTRYNAME</id>
      <enabled>Y</enabled>
      <name>STEPNAME</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>RESULT</id>
      <enabled>Y</enabled>
      <name>RESULT</name>
    </field>
    <field>
      <id>NR_RESULT_ROWS</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_ROWS</name>
    </field>
    <field>
      <id>NR_RESULT_FILES</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_FILES</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>N</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>COPY_NR</id>
      <enabled>N</enabled>
      <name>COPY_NR</name>
    </field>
  </jobentry-log-table>
  <channel-log-table>
    <connection/>
    <schema/>
    <table/>
    <timeout_days/>
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>LOGGING_OBJECT_TYPE</id>
      <enabled>Y</enabled>
      <name>LOGGING_OBJECT_TYPE</name>
    </field>
    <field>
      <id>OBJECT_NAME</id>
      <enabled>Y</enabled>
      <name>OBJECT_NAME</name>
    </field>
    <field>
      <id>OBJECT_COPY</id>
      <enabled>Y</enabled>
      <name>OBJECT_COPY</name>
    </field>
    <field>
      <id>REPOSITORY_DIRECTORY</id>
      <enabled>Y</enabled>
      <name>REPOSITORY_DIRECTORY</name>
    </field>
    <field>
      <id>FILENAME</id>
      <enabled>Y</enabled>
      <name>FILENAME</name>
    </field>
    <field>
      <id>OBJECT_ID</id>
      <enabled>Y</enabled>
      <name>OBJECT_ID</name>
    </field>
    <field>
      <id>OBJECT_REVISION</id>
      <enabled>Y</enabled>
      <name>OBJECT_REVISION</name>
    </field>
    <field>
      <id>PARENT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>PARENT_CHANNEL_ID</name>
    </field>
    <field>
      <id>ROOT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>ROOT_CHANNEL_ID</name>
    </field>
  </channel-log-table>
  <pass_batchid>N</pass_batchid>
  <shared_objects_file/>
  <entries>
    <entry>
      <name>Start</name>
      <description/>
      <type>SPECIAL</type>
      <attributes/>
      <start>Y</start>
      <dummy>N</dummy>
      <repeat>N</repeat>
      <schedulerType>0</schedulerType>
      <intervalSeconds>0</intervalSeconds>
      <intervalMinutes>60</intervalMinutes>
      <hour>12</hour>
      <minutes>0</minutes>
      <weekDay>1</weekDay>
      <DayOfMonth>1</DayOfMonth>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>32</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Success</name>
      <description/>
      <type>SUCCESS</type>
      <attributes/>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>1168</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>CreateTables</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>------------------------------------------------------------Create Dimensions
DROP TABLE IF EXISTS Dates CASCADE;
create table Dates (
  id char(8) not null,
  week char(7) not null,
  month char(6) not null,
  monthOfYear char(2) not null,
  year char(4) not null);
DELETE FROM schema WHERE tablename='Dates';

DROP TABLE IF EXISTS Weeks CASCADE;
create table Weeks (
  id char(7) not null,
  weekOfYear char(2) not null,
  weekMinus1 char(7) not null,
  weekMinus2 char(7) not null,
  weekMinus3 char(7) not null,
  weekMinus4 char(7) not null,
  weekMinus5 char(7) not null,
  weekMinus6 char(7) not null,
  weekMinus7 char(7) not null,
  weekMinus8 char(7) not null,
  yearOfWeek char(4) not null);
DELETE FROM schema WHERE tablename='Weeks';

DROP TABLE IF EXISTS Countries CASCADE;
create table Countries (
  id char(2) not null,
  name text not null,
  continent text null);
DELETE FROM schema WHERE tablename='Countries';

DROP TABLE IF EXISTS FirstAdminLevels CASCADE;
create table FirstAdminLevels (
  id varchar(5) not null,
  name text not null,
  country CHAR(2) not NULL,
  source text not NULL);
DELETE FROM schema WHERE tablename='FirstAdminLevels';

DROP TABLE IF EXISTS SecondAdminLevels CASCADE;
create table SecondAdminLevels (
  id varchar(5) not null,
  name text not null,
  fal varchar(5) not NULL);
DELETE FROM schema WHERE tablename='SecondAdminLevels';

------------------------------------------------------------Create Facts
DROP TABLE IF EXISTS COVIDData_perCountry CASCADE;
CREATE TABLE COVIDData_perCountry (
	country char(2) NOT NULL,
	date char(8) NOT NULL,
	cases INTEGER NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='COVIDData_perCountry';

DROP TABLE IF EXISTS COVIDData_perRegion CASCADE;
CREATE TABLE COVIDData_perRegion (
	region varchar(5) NOT NULL,
	date char(8) NOT NULL,
	cases INTEGER,
	deaths INTEGER);
DELETE FROM schema WHERE tablename='COVIDData_perRegion';

DROP TABLE IF EXISTS JHU_percountry CASCADE;
CREATE TABLE JHU_percountry (
	country char(2) NOT NULL,
	"date" char(8) NOT NULL,
	cases INTEGER NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='JHU_perCountry';

DROP TABLE IF EXISTS JHU_perregion CASCADE;
CREATE TABLE JHU_perregion (
	region varchar(5) NOT NULL,
	"date" char(8) NOT NULL,
	cases INTEGER,
	deaths INTEGER);
DELETE FROM schema WHERE tablename='JHU_perRegion';
/*^vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
DROP TABLE IF EXISTS ECDC_percountry CASCADE;
CREATE TABLE ECDC_percountry (
	country char(2) NOT NULL,
	"date" char(8) NOT NULL,
	cases INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='ECDC_perCountry';

DROP TABLE IF EXISTS OurWorldInData_percountry CASCADE;
CREATE TABLE OurWorldInData_percountry (
	country char(2) NOT NULL,
	"date" char(8) NOT NULL,
	cases INTEGER,
    deaths INTEGER);
DELETE FROM schema WHERE tablename='OurWorldInData_perCountry';
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^*/
DROP TABLE IF EXISTS EUROStats_perCountry_perWeek CASCADE;
CREATE TABLE EUROStats_perCountry_perWeek (
	country char(2) NOT NULL,
	week char(7) NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='EUROStats_perCountry_perWeek';

DROP TABLE IF EXISTS EUROStats_perCountry_perWeek_estimated CASCADE;
CREATE TABLE EUROStats_perCountry_perWeek_estimated (
	country char(2) NOT NULL,
	week char(7) NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='EUROStats_perCountry_perWeek_estimated';

DROP TABLE IF EXISTS EUROStats_perCountry_perYear CASCADE;
CREATE TABLE EUROStats_perCountry_perYear (
	country char(2) NOT NULL,
	year char(4) NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='EUROStats_perCountry_perYear';

DROP TABLE IF EXISTS EUROStats_perRegion CASCADE;
CREATE TABLE EUROStats_perRegion (
	region varchar(5) NOT NULL,
	week char(7) NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='EUROStats_perRegion';

DROP TABLE IF EXISTS EUROStats_perRegion_estimated CASCADE;
CREATE TABLE EUROStats_perRegion_estimated (
	region varchar(5) NOT NULL,
	week char(7) NOT NULL,
	deaths INTEGER NOT NULL);
DELETE FROM schema WHERE tablename='EUROStats_perRegion_estimated';</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>COVID-DB</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>160</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>LoadWorldData</name>
      <description/>
      <type>TRANS</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadWorld-COVIDData.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Basic</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <logging_remote_work>N</logging_remote_work>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>608</xloc>
      <yloc>48</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Declare Fact Constraints</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>--------------------------------------------------------------------------------------------------------Primary keys
ALTER TABLE coviddata_percountry ADD CONSTRAINT coviddata_percountry_pk PRIMARY KEY (country,"date");
ALTER TABLE coviddata_perregion ADD CONSTRAINT coviddata_perregion_pk PRIMARY KEY (region,"date");
ALTER TABLE JHU_percountry ADD CONSTRAINT JHU_percountry_pk PRIMARY KEY (country,"date");
ALTER TABLE JHU_perregion ADD CONSTRAINT JHU_perregion_pk PRIMARY KEY (region,"date");
/*vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
ALTER TABLE ECDC_percountry ADD CONSTRAINT ECDC_percountry_pk PRIMARY KEY (country,"date");
ALTER TABLE ourworldindata_percountry ADD CONSTRAINT ourworldindata_percountry_pk PRIMARY KEY (country,"date");
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^*/
ALTER TABLE eurostats_percountry_perweek ADD CONSTRAINT eurostats_percountry_perweek_pk PRIMARY KEY (country,week);
ALTER TABLE eurostats_percountry_perweek_estimated ADD CONSTRAINT eurostats_percountry_perweek_estimated_pk PRIMARY KEY (country,week);
ALTER TABLE eurostats_percountry_peryear ADD CONSTRAINT eurostats_percountry_peryear_pk PRIMARY KEY (country,year);
ALTER TABLE eurostats_perregion ADD CONSTRAINT eurostats_perregion_pk PRIMARY KEY (region,week);
ALTER TABLE eurostats_perregion_estimated ADD CONSTRAINT eurostats_perregion_estimated_pk PRIMARY KEY (region,week);

--------------------------------------------------------------------------------------------------------Foreign keys
ALTER TABLE coviddata_percountry ADD CONSTRAINT coviddata_percountry_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE coviddata_percountry ADD CONSTRAINT coviddata_percountry_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE coviddata_perregion ADD CONSTRAINT coviddata_perregion_fk2 FOREIGN KEY (region) REFERENCES FirstAdminLevels(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE coviddata_perregion ADD CONSTRAINT coviddata_perregion_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE jhu_percountry ADD CONSTRAINT jhu_percountry_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE jhu_percountry ADD CONSTRAINT jhu_percountry_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE jhu_perregion ADD CONSTRAINT jhu_perregion_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE jhu_perregion ADD CONSTRAINT jhu_perregion_fk2 FOREIGN KEY (region) REFERENCES FirstAdminLevels(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
/*vvvvvvvvvvvvvvvvvvvvvvvvvvv
ALTER TABLE ecdc_percountry ADD CONSTRAINT ecdc_percountry_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE ecdc_percountry ADD CONSTRAINT ecdc_percountry_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE ourworldindata_percountry ADD CONSTRAINT ourworldindata_percountry_fk FOREIGN KEY ("date") REFERENCES dates(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE ourworldindata_percountry ADD CONSTRAINT ourworldindata_percountry_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
^^^^^^^^^^^^^^^^^^^^^^^^^^^^*/
ALTER TABLE eurostats_percountry_perweek ADD CONSTRAINT eurostats_percountry_perweek_fk FOREIGN KEY (week) REFERENCES weeks(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_percountry_perweek ADD CONSTRAINT eurostats_percountry_perweek_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_percountry_perweek_estimated ADD CONSTRAINT eurostats_percountry_perweek_estimated_fk FOREIGN KEY (week) REFERENCES weeks(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_percountry_perweek_estimated ADD CONSTRAINT eurostats_percountry_perweek_estimated_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
--ALTER TABLE eurostats_percountry_peryear ADD CONSTRAINT eurostats_percountry_peryear_fk FOREIGN KEY (year) REFERENCES dates(year) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_percountry_peryear ADD CONSTRAINT eurostats_percountry_peryear_fk2 FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_perregion ADD CONSTRAINT eurostats_perregion_fk2 FOREIGN KEY (region) REFERENCES FirstAdminLevels(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_perregion ADD CONSTRAINT eurostats_perregion_fk FOREIGN KEY (week) REFERENCES weeks(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_perregion_estimated ADD CONSTRAINT eurostats_perregion_estimated_fk2 FOREIGN KEY (region) REFERENCES FirstAdminLevels(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE eurostats_perregion_estimated ADD CONSTRAINT eurostats_perregion_estimated_fk FOREIGN KEY (week) REFERENCES weeks(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>COVID-DB</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>880</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Wait for insertions</name>
      <description/>
      <type>EVAL_TABLE_CONTENT</type>
      <attributes/>
      <connection>COVID-DB</connection>
      <schemaname/>
      <tablename/>
      <success_condition>rows_count_greater_equal</success_condition>
      <limit>9</limit>
      <is_custom_sql>Y</is_custom_sql>
      <is_usevars>N</is_usevars>
      <custom_sql>SELECT DISTINCT tablename
FROM schema
WHERE tablename IN (
  'COVIDData_perCountry', 
  'COVIDData_perRegion', 
--  'ECDC_perCountry', 
  'JHU_perCountry',
  'JHU_perRegion',
--  'OurWorldInData_perCountry',
  'EUROStats_perCountry_perWeek',
  'EUROStats_perCountry_perWeek_estimated',
  'EUROStats_perCountry_perYear',
  'EUROStats_perRegion',
  'EUROStats_perRegion_estimated'
);</custom_sql>
      <add_rows_result>N</add_rows_result>
      <clear_result_rows>Y</clear_result_rows>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>736</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Load dimensions</name>
      <description/>
      <type>TRANS</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadWorld-Dimensions.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Basic</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <logging_remote_work>N</logging_remote_work>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>288</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Load JHU</name>
      <description/>
      <type>TRANS</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadWorld-JHU.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Basic</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <logging_remote_work>N</logging_remote_work>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>608</xloc>
      <yloc>160</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Update statistics</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>Analyze;</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>COVID-DB</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>1040</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Load demographics</name>
      <description/>
      <type>TRANS</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadWorld-EUROStatsDemographics-csv.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Basic</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <logging_remote_work>N</logging_remote_work>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>608</xloc>
      <yloc>272</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Declare Dimesion Constraints</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>--------------------------------------------------------------------------------------------------------Primary keys
ALTER TABLE Dates ADD CONSTRAINT dates_pk PRIMARY KEY (id);
ALTER TABLE Weeks ADD CONSTRAINT weeks_pk PRIMARY KEY (id);
ALTER TABLE Countries ADD CONSTRAINT countries_pk PRIMARY KEY (id);
ALTER TABLE FirstAdminLevels ADD CONSTRAINT firstadminlevels_pk PRIMARY KEY (id);
ALTER TABLE SecondAdminLevels ADD CONSTRAINT secondadminlevels_pk PRIMARY KEY (id);

--------------------------------------------------------------------------------------------------------Unique constraints
CREATE UNIQUE INDEX countries_ak on Countries(name);
CREATE UNIQUE INDEX firstadminlevels_ak on FirstAdminLevels(name);
CREATE UNIQUE INDEX secondadminlevels_ak on SecondAdminLevels(name);

--------------------------------------------------------------------------------------------------------Foreign keys
ALTER TABLE Dates ADD CONSTRAINT dates_fk FOREIGN KEY (week) REFERENCES weeks(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE FirstAdminLevels ADD CONSTRAINT firstadminlevels_fk FOREIGN KEY (country) REFERENCES Countries(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;
ALTER TABLE SecondAdminLevels ADD CONSTRAINT secondaminlevels_fk FOREIGN KEY (fal) REFERENCES FirstAdminLevels(id) ON DELETE CASCADE ON UPDATE CASCADE DEFERRABLE;


</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>COVID-DB</connection>
      <parallel>Y</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>464</xloc>
      <yloc>208</yloc>
      <attributes_kjc/>
    </entry>
  </entries>
  <hops>
    <hop>
      <from>Start</from>
      <to>CreateTables</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>LoadWorldData</from>
      <to>Wait for insertions</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Wait for insertions</from>
      <to>Declare Fact Constraints</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>CreateTables</from>
      <to>Load dimensions</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Load JHU</from>
      <to>Wait for insertions</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Declare Fact Constraints</from>
      <to>Update statistics</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Update statistics</from>
      <to>Success</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Load demographics</from>
      <to>Wait for insertions</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Load dimensions</from>
      <to>Declare Dimesion Constraints</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Declare Dimesion Constraints</from>
      <to>LoadWorldData</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Declare Dimesion Constraints</from>
      <to>Load JHU</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Declare Dimesion Constraints</from>
      <to>Load demographics</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
  </hops>
  <notepads>
  </notepads>
  <attributes>
    <group>
      <name>METASTORE.pentaho</name>
      <attribute>
        <key>Default Run Configuration</key>
        <value>{"namespace":"pentaho","id":"Default Run Configuration","name":"Default Run Configuration","description":"Defines a default run configuration","metaStoreName":null}</value>
      </attribute>
    </group>
    <group>
      <name>{"_":"Embedded MetaStore Elements","namespace":"pentaho","type":"Default Run Configuration"}</name>
      <attribute>
        <key>Pentaho local</key>
        <value>{"children":[{"children":[],"id":"server","value":null},{"children":[],"id":"clustered","value":"N"},{"children":[],"id":"name","value":"Pentaho local"},{"children":[],"id":"description","value":null},{"children":[],"id":"pentaho","value":"N"},{"children":[],"id":"readOnly","value":"Y"},{"children":[],"id":"sendResources","value":"N"},{"children":[],"id":"logRemoteExecutionLocally","value":"N"},{"children":[],"id":"remote","value":"N"},{"children":[],"id":"local","value":"Y"},{"children":[],"id":"showTransformations","value":"N"}],"id":"Pentaho local","value":null,"name":"Pentaho local","owner":null,"ownerPermissionsList":[]}</value>
      </attribute>
    </group>
  </attributes>
</job>
